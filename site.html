<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Genji Documentation</title>
    <link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans&subset=latin">
    <link type="text/css" rel="stylesheet" href="css/reset.css">
    <link type="text/css" rel="stylesheet" href="css/docs.css">
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print">
    <link type="text/css" rel="stylesheet" href="http://yandex.st/highlightjs/6.1/styles/sunburst.min.css">
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://yandex.st/highlightjs/6.1/highlight.min.js"></script>
    
    <script type="text/javascript" src="js/viewer.js"></script>
</head>
<body>
    <div id="page">
        <a name="top" />
        
            <header id="header">
                <h1><a href="">Genji Documentation</a></h1>
            </header>
        
        


    <div id="sidebar">
        <nav id="toc">
            
    <ol>
    
        <li>
            <a href="readme.html#genji">Genji </a>
            
                
    <ol>
    
        <li>
            <a href="readme.html#introduction">Introduction</a>
            
        </li>
    
        <li>
            <a href="readme.html#license">License</a>
            
        </li>
    
</ol>

            
        </li>
    
        <li>
            <a href="way.html#the-way-to-genji">The way to Genji</a>
            
                
    <ol>
    
</ol>

            
        </li>
    
        <li>
            <a href="router.html#router">Router</a>
            
                
    <ol>
    
        <li>
            <a href="router.html#add-route-definition">Add route definition</a>
            
        </li>
    
        <li>
            <a href="router.html#hooks">Hooks</a>
            
        </li>
    
        <li>
            <a href="router.html#listen-to-server-event">Listen to server event</a>
            
        </li>
    
        <li>
            <a href="router.html#api">API</a>
            
        </li>
    
</ol>

            
        </li>
    
        <li>
            <a href="app.html#app">App</a>
            
                
    <ol>
    
        <li>
            <a href="app.html#define-app">Define app</a>
            
        </li>
    
        <li>
            <a href="app.html#handle-result">Handle result</a>
            
        </li>
    
        <li>
            <a href="app.html#extending">Extending</a>
            
        </li>
    
        <li>
            <a href="app.html#conventions">Conventions</a>
            
        </li>
    
        <li>
            <a href="app.html#api">API</a>
            
        </li>
    
</ol>

            
        </li>
    
        <li>
            <a href="site.html#site">Site</a>
            
                
    <ol>
    
        <li>
            <a href="site.html#getter-setter">Getter/Setter</a>
            
        </li>
    
        <li>
            <a href="site.html#use-middleware">Use middleware</a>
            
        </li>
    
        <li>
            <a href="site.html#load-app">Load app</a>
            
        </li>
    
        <li>
            <a href="site.html#routing">Routing</a>
            
        </li>
    
        <li>
            <a href="site.html#output-result">Output result</a>
            
        </li>
    
        <li>
            <a href="site.html#environment">Environment</a>
            
        </li>
    
        <li>
            <a href="site.html#start-your-site">Start your site</a>
            
        </li>
    
</ol>

            
        </li>
    
        <li>
            <a href="base.html#base">Base</a>
            
                
    <ol>
    
        <li>
            <a href="base.html#klass">Klass</a>
            
        </li>
    
        <li>
            <a href="base.html#base">Base</a>
            
        </li>
    
</ol>

            
        </li>
    
        <li>
            <a href="changelog.html#changelog">CHANGELOG</a>
            
                
    <ol>
    
        <li>
            <a href="changelog.html#07-2013">0.7 (2013)</a>
            
        </li>
    
        <li>
            <a href="changelog.html#05-2012">0.5 (2012)</a>
            
        </li>
    
</ol>

            
        </li>
    
</ol>

        </nav>
    </div>

<article id="content">
    <a name="site"></a><h1>Site</h1>
<p><strong>Site</strong> is the organizer for your applications. And using <strong>Site</strong> is the recommended way to use Genji when you have a
large/complex project. It has the following features:</p>
<ul>
<li>It inherits <code>EventEmitter</code></li>
<li>It has setter/getter methods which can be used to save and retrieve <code>settings</code></li>
<li>It can load and expose your <code>app</code> to external world and manage maps between url and app function</li>
<li>It works with <a href="core.html">Core</a> - the <code>plugin</code> system</li>
<li>It works with <code>view</code> and renders result by convention</li>
<li>Settings, plugins and apps are all namespaced by <code>env</code></li>
</ul>
<p>A <code>site</code> object can be created by calling <code>genji.site()</code>:</p>
<pre><code class="lang-javascript">var mySite = genji.site();</code></pre>
<a name="getter-setter"></a><h2>Getter/Setter</h2>
<p>You can use <code>mySite</code> to set and get settings.</p>
<pre><code class="lang-javascript">
mySite.set(&#39;title&#39;, &#39;My Great Website&#39;);

// &#39;My Great Website&#39;
var title = mySite.get(&#39;title&#39;);

// set a batch of settings
mySite.set({
  host: &#39;127.0.0.1&#39;,
  port: 8888
});

// get a batch of settings
var settings = mySite.get([&#39;title&#39;, &#39;host&#39;, &#39;port&#39;]);
// {title: &#39;My Great Website&#39;, host: &#39;127.0.0.1&#39;, port: 8888}</code></pre>
<a name="use-middleware"></a><h2>Use middleware</h2>
<p>You don&#39;t have to initialize <a href="#core.html">middleware manager</a> by yourself when you use site. You only need to call <code>use</code> method of the
site instance.</p>
<pre><code class="lang-javascript">
// use built-in middlewares
mySite.use(&#39;conditional-get&#39;);
mySite.use(&#39;logger&#39;, conf);

// use custom middleware

mySite.use(function(core, conf) {
    // do something
  }, conf);</code></pre>
<a name="load-app"></a><h2>Load app</h2>
<p>Using app with site is as simple as middleware. But instead of <code>use</code> you need to call <code>load</code> with app instance.</p>
<pre><code class="lang-javascript">
var blog = new BlogApp();
mySite.load(blog);

// site instance will be setted to app instance&#39;s `delegate` property
// blog.delegate === mySite</code></pre>
<p>If you have a lots of apps which have similar initializing options. Then you can set the default app options and let
site initialize them for you.</p>
<pre><code class="lang-javascript">var options = {x: 1, y: 2};
mySite.set(&#39;appOptions&#39;, options);
mySite.load(BlogApp);
mySite.load(MyOtherApp);</code></pre>
<p>The default options could be overridden and inherited.</p>
<pre><code class="lang-javascript">var someOptions = {y: 3, z: 2};
// the actual intializing option is {x: 1, y: 3, z: 2}
mySite.load(SomeApp, someOptions);
// load three apps at once
mySite.load([SomeApp1, SomeApp2, SomeApp3], someOptions);</code></pre>
<a name="routing"></a><h2>Routing</h2>
<p>All methods in the <code>app.publicMethods</code> property will be mapped to url by default follows the <a href="app#naming-and-url-mapping">convention</a>.
For example, the <code>blog.createPost</code> will be mapped to url that matches <code>^/blog/create/post</code> by default.
Of course, if the default convention/mapping does not meet your needs, you can use the <code>map</code> function to map individual
url to app method and override the default options.</p>
<pre><code class="lang-javascript">
mySite.map({
  // handle `POST` requests for url &#39;/blog/create/post&#39;
  blogCreatePost: {method: &#39;post&#39;}
  // handle both `GET` and `POST` requests for url &#39;/blog/read/post/:id&#39;
  blogReadPost: {url: &#39;^/blog/read/post/[0-9]{16}&#39;},
  // add hooks
  blogUpdatePost: {method: &#39;put&#39;, hooks: [preFn1, null, postFn1]}
});</code></pre>
<p>If you have predefined routing definition object, you can load it at the same time when loading app.</p>
<pre><code class="lang-javascript">
var routes = {
  // it&#39;s an app default settings if the property key of the route is one of the app&#39;s name (in lower case)
  blog: {hooks: [fn1, null, fn2], method: &#39;get&#39;, urlRoot: &#39;^/blog/&#39;},
  blogReadPost: {url: &#39;^/blog/read/post/[0-9]{16}&#39;},
  // a comprehensive route definition
  blogCreatePost: {
    url: &#39;/create/post&#39;,
    method: &#39;post&#39;,
    hooks: [fn3, fn4, null, fn5],
    view: &#39;json&#39; // see [Output result](#output-result)
  }
};

mySite.load(AnotherApp, someOptions, routes);</code></pre>
<p>The <code>routes.blog</code> object holds default settings for all <code>publicMethods</code> of <code>blog</code> instance. It means if some setting is
not specified in route, it will use the default one provided by <code>routes.blog</code>. And hooks will be combined. So the final
routes of above example normalized by genji would be:</p>
<pre><code class="lang-javascript">var routes = {
  blogReadPost: {
    url: &#39;^/blog/read/post/[0-9]{16}&#39;,
    method: &#39;get&#39;,
    hooks: [fn1, null, fn2],
    view: &#39;html&#39; // site default value, see [Output result](#output-result)
  },
  // a comprehensive route definition
  blogCreatePost: {
    url: &#39;^/blog/create/post&#39;,
    method: &#39;post&#39;,
    hooks: [fn1, fn3, fn4, null, fn5, fn2],
    view: &#39;json&#39; // see [Output result](#output-result)
  }
};</code></pre>
<a name="output-result"></a><h2>Output result</h2>
<p>We already knew how to map a url to an app&#39;s method. Let&#39;s see how we can output the result.</p>
<ul>
<li>Output the result as html string (default):</li>
</ul>
<pre><code class="lang-javascript">
  blogReadPost: {url: &#39;^/blog/read/post/[0-9]{16}&#39;, view: &#39;html&#39;}</code></pre>
<ul>
<li>Output the result as json string:</li>
</ul>
<pre><code class="lang-javascript">
  blogReadPost: {url: &#39;^/blog/read/post/[0-9]{16}&#39;, view: &#39;json&#39;}</code></pre>
<ul>
<li>Handle result by customized function:</li>
</ul>
<pre><code class="lang-javascript">
  blogReadPost: {url: &#39;^/blog/read/post/[0-9]{16}&#39;, view: function(err, result) {
    if (err) {
      this.error(err);
      return;
    }
    this.sendJSON(result);
  }}</code></pre>
<p>When you use genji&#39;s <code>view</code> system, site can render view template automatically for you.</p>
<pre><code class="lang-javascript">
var hogan = require(&#39;hogan.js&#39;);
mySite.use(&#39;view&#39;, {engine: hogan, rootViewPath: __dirname});

mySite.map({

  // render template file at &quot;rootViewPath + /blog/views/read_post.html&quot;
  blogReadPost: {url: &#39;^/blog/read/post/[0-9]{16}&#39;, view: &#39;/blog/views/read_post.html&#39;},

  // the default behavior is try to find a template file at &quot;rootViewPath + /blog/update_post.html&quot; if you use the view system
  blogUpdatePost: {method: &#39;put&#39;}

});</code></pre>
<p>Of course, it&#39;s possible to do some tweaks and render manually.</p>
<pre><code class="lang-javascript">
  blogUpdatePost: {method: &#39;put&#39;, view: function(err, result) {
    result.someValue = 1;

    // auto template file discovery, render and send
    this.render(result);

    // or indicates template view name manually
    this.render(&#39;blog/update_post.html&#39;, result);

    var self = this;
    // or render and send manually
    this.render(&#39;/path/to/blog/views/update_post.html&#39;, result, function (err, html) {
      self.sendHTML(html);
    });
  }}</code></pre>
<a name="environment"></a><h2>Environment</h2>
<p>By using <code>env</code> you can have different settings, middlewares and apps for different environments. The default environment
named <code>default</code>.</p>
<pre><code class="lang-javascript">
// switch to environment &quot;dev&quot;
mySite.env(&#39;dev&#39;);

// the following title and middleware will be used if your &#39;process.env.NODE_ENV&#39; === &#39;dev&#39;
mySite.set(&#39;title&#39;, &#39;[DEV] My Great Website&#39;);
mySite.use(&#39;dev-verbose&#39;, &#39;all&#39;);
// the &quot;DevApp&quot; is also only avaliable for &quot;dev&quot; environment
mySite.load(DevApp);

// switch back to the &#39;default&#39; environment
mySite.env(); // or mySite.env(&#39;default&#39;)</code></pre>
<p>The <code>dev</code> environment inherits <code>default</code>. It means all settings, middlewares and apps setted before you switched to <code>dev</code>
are also setted/used/loaded. So when you switched to new environment, <code>set/use/load</code> overrides the differences.</p>
<a name="start-your-site"></a><h2>Start your site</h2>
<p>Start the server is easy</p>
<pre><code class="lang-javascript">
 mySite.start();</code></pre>

</article>

        <footer id="footer">
            Powered by <a href="http://github.com/maximebf/beautiful-docs">beautiful-docs</a> -
            <a href="#top">Back to top</a> - <a href="all.html">Everything on a single page</a>
            - <a href="?print=1">Print current page</a> - <a href="all.html?print=1">Print all pages</a>
            
                <a href="https://github.com/lsm/genji" id="fork-me-on-github">Fork me on Github</a>
            
        </footer>
    </div>
</body>
</html>
